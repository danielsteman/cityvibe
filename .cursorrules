# Python Code Standards

## HTTP Requests

- Always use `httpx` for making HTTP requests (both sync and async)
- Prefer `httpx.AsyncClient` for async code
- Do not use `requests`, `urllib`, or `aiohttp` for HTTP requests
- Use proper context managers or `async with` for client lifecycle management

## Type Annotations

- Use type annotations for all function parameters, return types, and class attributes
- Prefer builtin types (`list`, `dict`, `tuple`, `set`) over `typing` module equivalents when possible (Python 3.9+)
- Use `list[str]` instead of `List[str]`
- Use `dict[str, int]` instead of `Dict[str, int]`
- Use `tuple[int, str]` instead of `Tuple[int, str]`
- Use `set[str]` instead of `Set[str]`
- Only import from `typing` when necessary (e.g., `Optional`, `Union`, `Any`, `Callable`, `Protocol`, `TYPE_CHECKING`)
- Use `|` for unions when possible (Python 3.10+): `str | int` instead of `Union[str, int]`
- Use `X | None` instead of `Optional[X]` when possible (Python 3.10+)

## Code Quality

- All code must pass the configured linters (ruff and mypy)
- Run `ruff check` and `mypy` before committing code
- Fix all linting errors and type checking issues
- Follow the project's ruff configuration (line length: 100, Python 3.13 target)

## Imports

- All imports must be at the top of the file, after module docstrings but before any other code
- Group imports in this order: standard library, third-party, local imports
- Use blank lines to separate import groups
- Do not place imports inside functions, classes, or conditional blocks (except for `TYPE_CHECKING` imports)

## Logging

- Always use `loguru` for logging instead of `print` statements
- Import logger with: `from loguru import logger`
- Use appropriate log levels:
  - `logger.debug()` for detailed debugging information
  - `logger.info()` for general informational messages
  - `logger.warning()` for warning messages
  - `logger.error()` for error conditions
  - `logger.exception()` for exceptions (automatically includes traceback)
- Never use `print()` statements in production code - use loguru instead
- **Every log statement MUST start with an emoji** that best matches the message content:
  - âœ… Success/completion: `logger.info("âœ… Successfully scraped 42 events")`
  - âŒ Error/failure: `logger.error("âŒ Failed to connect to API")`
  - âš ï¸ Warning: `logger.warning("âš ï¸ Rate limit approaching")`
  - ğŸ” Debug/investigation: `logger.debug("ğŸ” Parsing HTML content")`
  - ğŸš€ Start/initiation: `logger.info("ğŸš€ Starting scraper for venue")`
  - ğŸ“Š Data/metrics: `logger.info("ğŸ“Š Found 15 events in database")`
  - ğŸ”„ Retry/retry: `logger.info("ğŸ”„ Retrying request (attempt 2/3)")`
  - â±ï¸ Timing/performance: `logger.info("â±ï¸ Request took 1.2s")`
  - ğŸ” Security/auth: `logger.warning("ğŸ” Authentication token expired")`
  - ğŸ’¾ Save/persistence: `logger.info("ğŸ’¾ Saved 10 events to database")`
  - ğŸ—‘ï¸ Delete/cleanup: `logger.info("ğŸ—‘ï¸ Cleaned up old cache entries")`
  - ğŸ“¥ Download/fetch: `logger.info("ğŸ“¥ Fetching HTML from URL")`
  - ğŸ“¤ Upload/send: `logger.info("ğŸ“¤ Sending events to API")`
  - ğŸ”— Connection/network: `logger.info("ğŸ”— Connected to database")`
  - âš¡ Performance/optimization: `logger.info("âš¡ Optimized query execution")`
  - ğŸ¯ Target/goal: `logger.info("ğŸ¯ Processing target venue")`
  - ğŸ“ Parse/process: `logger.debug("ğŸ“ Parsing event data")`
  - ğŸ¨ Format/transform: `logger.debug("ğŸ¨ Formatting event output")`
  - Choose the most appropriate emoji for the context, or use a generic one if none fit perfectly

## Docstrings

- Use Google-style docstrings consistently across all code
- **Module-level docstrings**: Single-line summary ending with a period
  ```python
  """Filmladder scraper for extracting event data."""
  ```
- **Class docstrings**: Multi-line with a brief description, followed by additional context if needed

  ```python
  """
  Scraper for extracting events from Filmladder.

  Filmladder is a Dutch cinema listing website. This scraper extracts
  film showtimes and event information from the Amsterdam cinemas page.
  """
  ```

- **Function/method docstrings**: Must include:

  - Brief one-line summary (if the function is simple)
  - OR multi-line description for complex functions
  - `Args:` section listing all parameters with types and descriptions
  - `Returns:` section describing the return value and type
  - `Raises:` section if the function can raise exceptions

  ```python
  """
  Extract events from Filmladder.

  Args:
      html: HTML content from the Filmladder page
      base_url: Base URL for constructing absolute links

  Returns:
      List of raw event dictionaries

  Raises:
      ValueError: If HTML content is invalid
  """
  ```

- Use present tense, third person for descriptions: "Extract events" not "Extracts events" or "Extracting events"
- Keep descriptions concise but informative
- Always end docstring summary lines with a period
- For private methods (starting with `_`), docstrings are optional but recommended for complex logic

## General Python Best Practices

- Use f-strings for string formatting
- Prefer pathlib.Path over os.path for file operations
- Use dataclasses or Pydantic models for structured data
- Follow PEP 8 style guidelines (enforced by ruff)
- Use async/await properly for asynchronous operations
- Handle errors appropriately with try/except blocks
